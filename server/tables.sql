USE LIHI;
CREATE TABLE IF NOT EXISTS VILLAGES (VID INT PRIMARY KEY auto_increment, NAME VARCHAR(50) NOT NULL UNIQUE);
CREATE TABLE IF NOT EXISTS PERMISSIONS (ROLE_ID INT PRIMARY KEY auto_increment, ROLE_TYPE VARCHAR(255) NOT NULL UNIQUE);
CREATE TABLE IF NOT EXISTS PEOPLE (PID INT PRIMARY KEY auto_increment, FIRST_NAME VARCHAR(50) NOT NULL, LAST_NAME VARCHAR(50) NOT NULL, BIRTHDAY DATE, ROLE_ID INT NOT NULL, VID INT NULL, CONSTRAINT FK_Permission FOREIGN KEY (ROLE_ID) REFERENCES PERMISSIONS(ROLE_ID), CONSTRAINT FK_Village FOREIGN KEY (VID) REFERENCES VILLAGES(VID));
CREATE TABLE IF NOT EXISTS ROOMS (ROOM_ID INT PRIMARY KEY auto_increment, ROOM_NUM INT NOT NULL, BLDG_NAME VARCHAR(50) NOT NULL, VID INT NOT NULL, VACANT BOOLEAN, CONSTRAINT FK_VID FOREIGN KEY (VID) REFERENCES VILLAGES(VID));
CREATE TABLE IF NOT EXISTS RESIDENTS (RID INT PRIMARY KEY auto_increment, PID INT NOT NULL, ROOM_ID INT NOT NULL, START_DATE DATE NOT NULL, END_DATE DATE, IN_RESIDENCE BOOLEAN, CONSTRAINT FK_PeopleID FOREIGN KEY (PID) REFERENCES PEOPLE(PID), CONSTRAINT FK_ROOMID FOREIGN KEY(ROOM_ID) REFERENCES ROOMS(ROOM_ID));
CREATE TABLE IF NOT EXISTS INCIDENTS (INID INT PRIMARY KEY auto_increment, INCIDENT_DATE DATE NOT NULL, VID INT NOT NULL, LOCATION VARCHAR(255) NOT NULL, DESCRIPTION VARCHAR(1000), INJURY BOOLEAN NOT NULL, INJURY_DESCRIPTION VARCHAR(1000), ER_VISIT BOOLEAN NOT NULL, ER_HOSPITAL VARCHAR(255), POLICE_REPORT BOOLEAN NOT NULL, PR_NUMBER VARCHAR(255), AUTHOR_ID INT NOT NULL, REVIEWER_ID INT NOT NULL, AUTHOR_DATE DATE NOT NULL, CONSTRAINT FK_AUTHOR FOREIGN KEY (AUTHOR_ID) REFERENCES PEOPLE(PID), CONSTRAINT FK_REVIEWER FOREIGN KEY (REVIEWER_ID) REFERENCES PEOPLE(PID), CONSTRAINT FK_VILLAGE_ID FOREIGN KEY (VID) REFERENCES VILLAGES(VID))
CREATE TABLE IF NOT EXISTS INCIDENTS_PEOPLE (IP_ID INT PRIMARY KEY auto_increment, INID INT NOT NULL, PID INT NOT NULL, CONSTRAINT FK_INID FOREIGN KEY (INID) REFERENCES INCIDENTS(INID), CONSTRAINT FK_PID FOREIGN KEY (PID) REFERENCES PEOPLE(PID))
CREATE TABLE IF NOT EXISTS INCIDENTS_OBSERVER (IP_ID INT PRIMARY KEY auto_increment, INID INT NOT NULL, PID INT NOT NULL, CONSTRAINT FK_OBSERVER_INID FOREIGN KEY (INID) REFERENCES INCIDENTS(INID), CONSTRAINT FK_OBSERVER_PID FOREIGN KEY (PID) REFERENCES PEOPLE(PID))
CREATE TABLE IF NOT EXISTS INCIDENTS_NOTIFIED ( IP_ID INT PRIMARY KEY auto_increment, INID INT NOT NULL, PID INT NOT NULL, CONSTRAINT FK_NOTIFIED_INID FOREIGN KEY (INID) REFERENCES INCIDENTS(INID), CONSTRAINT FK_NOTIFIED_PID FOREIGN KEY (PID) REFERENCES PEOPLE(PID))
CREATE TABLE IF NOT EXISTS CREDENTIALS (CID INT PRIMARY KEY auto_increment, PID INT NOT NULL, EMAIL VARCHAR(255) NOT NULL, PASSWORD VARCHAR(255) NOT NULL)
INSERT INTO VILLAGES (NAME) VALUES ("Interbay"), ("Whittier"), ("Othello"), ("Camp second chance"), ("Spirit"), ("Lake Union"), ("Plum st"), ("TEMS"), ("True Hope"), ("Georgetown"), ("Northlake");
INSERT INTO PERMISSIONS (ROLE_TYPE) VALUES ('Employee'), ('Admin'), ('Resident');
INSERT INTO PEOPLE (FIRST_NAME, LAST_NAME, BIRTHDAY, ROLE_ID, VID) VALUES ("Jennifer", "Smith", "1987-01-12", 3, 1), ("Sam", "Jackson", "1989-10-12", 3, 2);
INSERT INTO PEOPLE (FIRST_NAME, LAST_NAME, ROLE_ID) VALUES ("Admin", "LIHI", 2);
INSERT INTO CREDENTIALS (PID, EMAIL, PASSWORD) VALUES (3, "admin@lihi.org", "$2a$10$i20UIxsWH.w9P1lHaH34SudVOHFoaFISbMN0kwE1ClT5jxIRpIJxC");
INSERT INTO ROOMS(ROOM_NUM, BLDG_NAME, VID, VACANT) VALUES (24, "Building1" , 1, TRUE), (20, "Building2", 2, TRUE);
INSERT INTO RESIDENTS(PID, ROOM_ID, START_DATE, END_DATE, IN_RESIDENCE) VALUES (1, 1, "2020-01-15", "2020-02-20", TRUE), (2, 2, "2020-01-15", "2020-02-20", TRUE);